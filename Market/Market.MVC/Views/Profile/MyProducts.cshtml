@model Market.MVC.Models.Profile.MyProductsVM

<main role="main">
    <div class="wrapper">
        <div class="breadcrumb-wrap">
            <div class="container py-3">
                <div class="row d-flex justify-content-md-between justify-content-sm-center">
                    <div class="col-md-4">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item ml-1 font-weight-bold active" aria-current="page">
                                    My Items
                                </li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>


        <div class="container">
            <div class="row">
                <partial name="_ProfileSidebar" />
                <div class="col-lg-9">
                    <div class="row">
                        <div class="col">
                            <!-- my items table -->
                            <div class="card product_item_list mb-4">
                                <div class="card-header py-3 border-bottom">
                                    <div class="d-flex align-items-center">
                                        <div>
                                            <h6 class="card-title mb-0">Published Items</h6>
                                        </div>

                                    </div>
                                </div>
                                <div class="card-body pt-4">
                                    <div class="table-responsive">
                                        <table class="table table-hover m-b-0">
                                            <thead>
                                            <tr>
                                                <th class="border-0">Item Name</th>
                                                <th class="border-0" data-breakpoints="xs">Price</th>

                                                <th class="border-0" data-breakpoints="sm xs md">Action</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            @foreach (var product in Model.MyProducts)
                                            {
                                                <tr>
                                                    <a asp-controller="Items" asp-action="Details" asp-route-id="@product.Id">
                                                        <td>
                                                            <h6>@product.Title</h6>
                                                        </td>
                                                        <td>@product.Price</td>

                                                        <td>
                                                            <div class="btn-group" role="group" aria-label="Basic example">
                                                                @* <button type="button" class="btn btn-sm btn-primary"><i class="las la-edit"></i></button> *@
                                                                <button type="button" class="btn btn-sm btn-danger delete-product" data-product-id="@product.Id"><i class="las la-trash-alt"></i></button>
                                                            </div>
                                                        </td>
                                                    </a>
                                                </tr>
                                            }
                                            </tbody>
                                        </table>
                                    </div>
                                    <hr>
                                </div>
                            </div>
                            <!-- end: My items table-->

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </main>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deleteButtons = document.querySelectorAll('.delete-product');
            
            deleteButtons.forEach(button => {
                button.addEventListener('click', async function() {
                    if (confirm('Вы уверены, что хотите удалить этот товар?')) {
                        const productId = this.getAttribute('data-product-id');
                        try {
                            const response = await fetch(`/Items/Delete/${productId}`, {
                                method: 'DELETE'
                            });
                            
                            if (response.ok) {
                                // Удаляем строку таблицы с товаром
                                this.closest('tr').remove();
                            } else {
                                alert('Произошла ошибка при удалении товара');
                            }
                        } catch (error) {
                            console.error('Ошибка:', error);
                            alert('Произошла ошибка при удалении товара');
                        }
                    }
                });
            });
        });
    </script>
}